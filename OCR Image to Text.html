<!doctype html><html><head></head><body><!doctype html>
<html>

<head></head>

<body>
	<!doctype html>
	<html>

	</head>

	<body>
		<!DOCTYPE html>
		<html lang="en">

		<head>
			<meta charset="UTF-8" />
			<meta name="viewport" content="width=device-width, initial-scale=1" />
			<title>OCR Image to Text</title>

			<!-- Tesseract.js -->
			<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

			<!-- Cropper.js CSS & JS -->
			<link href="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.css" rel="stylesheet" />
			<script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.js"></script>

			<style>
				body {
					font-family: Arial, sans-serif;
					padding: 20px;
					background-color: #c4d7f2;
				}

				.container {
					max-width: 900px;
					margin: auto;
					background: white;
					padding: 20px;
					box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
					border-radius: 6px;
				}

				header,
				footer {
					background-color: #944d45;
					/* light reddish brown */
					color: white;
					padding: 15px 20px;
					text-align: center;
					font-family: Arial, sans-serif;
				}

				footer {
					font-size: 14px;
					margin-top: 30px;
				}

				.instructions-box {
					background: #fff4f0;
					padding: 15px;
					border-radius: 5px;
					margin-bottom: 20px;
					color: #6b3a2a;
					font-size: 14px;
				}

				h2 {
					margin-bottom: 10px;
					text-align: center;
				}


				input[type="file"] {
					display: none;
				}

				.custom-wrapper {
					text-align: center;
					margin-bottom: 20px;
				}

				/* Style the custom upload button */
				.custom-upload-btn {
					display: inline-block;
					padding: 8px 15px;
					background-color: #007bff;
					color: white;
					font-weight: 500;
					border-radius: 5px;
					cursor: pointer;
					transition: background-color 0.3s ease;
					user-select: none;
					font-family: Arial, sans-serif;
					margin-bottom: 15px;
				}

				.custom-upload-btn:hover {
					background-color: #0056b3;
				}

				#image-container {
					max-width: 80%;
					margin: 10px auto;
					margin-bottom: 10px;
					text-align: center;
					border: 1px solid #ccc;
					border-radius: 5px;
					position: relative;
					padding: 5px;
					height: auto;
					border: 1px solid black;
				}

				#image-preview {
					max-width: 100%;
					margin: 0 auto;
					display: block;
					border-radius: 5px;
				}

				#crop-btn,
				#ocr-btn,
				#copy-btn,
				#download-btn {
					margin: 8px 6px 0 0;
					padding: 10px 18px;
					border: none;
					border-radius: 4px;
					cursor: pointer;
					color: white;
					font-weight: 600;
					transition: background-color 0.3s ease;
				}

				#crop-btn {
					background-color: #28a745;
				}

				#crop-btn:hover {
					background-color: #218838;
				}

				#ocr-btn {
					background-color: #007bff;
				}

				#ocr-btn:hover {
					background-color: #0056b3;
				}

				#copy-btn {
					background-color: #17a2b8;
				}

				#copy-btn:hover {
					background-color: #117a8b;
				}

				#download-btn {
					background-color: #6f42c1;
				}

				#download-btn:hover {
					background-color: #4e2a8e;
				}

				#status {
					margin-top: 12px;
					min-height: 24px;
					color: #333;
					font-weight: 600;
				}

		    #action-message {
		      text-align: center;
		      font-weight: bold;
		      margin-top: 10px;
		      color: green;
		      transition: opacity 0.3s ease;
		    }

				#text-output {
					width: 80%;
					margin: 0 auto;
					background: #eef;
					padding: 15px;
					border-radius: 5px;
					white-space: pre-wrap;
					min-height: 140px;
					overflow-wrap: break-word;
					font-size: 15px;
					line-height: 1.5;
					border: 1.5px solid black;
				}

				.buttons-row {
					margin-top: 10px;
				}

				@media (max-width: 600px) {

					#crop-btn,
					#ocr-btn,
					#copy-btn,
					#download-btn {
						width: 100%;
						margin: 6px 0 0 0;
					}
				}
			</style>
		</head>

		<body>

			<header>
				<h2>OCR Image to Text</h2>
			</header>

			<div class="instructions-box">
				<strong>Image Instructions:</strong>
				<ul>
					<li>Use clear, high-resolution images with sharp, legible text.</li>
					<li>Ensure good lighting and strong contrast between text and background.</li>
					<li>Avoid blurry or low-quality images for better OCR results.</li>
				</ul>
			</div>

			<div class="custom-wrapper">
				<label for="image-upload" class="custom-upload-btn">Upload Image</label>
				<input type="file" id="image-upload" accept="image/*" />
				<div id="image-container">
					<img id="image-preview" alt="Select an image to preview and crop" />
		</div>

					<div class="buttons-row">
						<button id="crop-btn" disabled>Crop Selection</button>
						<button id="ocr-btn" disabled>Extract Text (OCR)</button>
					</div>

					<p id="status"></p>

					<div id="text-output" placeholder="Extracted text will appear here..."></div>

					<div class="buttons-row">
						<button id="copy-btn" disabled>Copy Text</button>
						<button id="download-btn" disabled>Download as .txt</button>
				  <p id="action-message"></p>
					</div>
				</div>
			</div>

			<footer>
				&copy; 2025 | OCR Image to Text by EKR
			</footer>

			<script>
				const imageUpload = document.getElementById('image-upload');
		const imagePreview = document.getElementById('image-preview');
		const imageContainer = document.getElementById('image-container');
		const cropBtn = document.getElementById('crop-btn');
		const ocrBtn = document.getElementById('ocr-btn');
		const statusText = document.getElementById('status');
		const textOutput = document.getElementById('text-output');
		const copyBtn = document.getElementById('copy-btn');
		const downloadBtn = document.getElementById('download-btn');

		let cropper = null;
		let croppedCanvas = null;

		imageUpload.addEventListener('change', () => {
			const file = imageUpload.files[0];
			if (!file) return resetAll();

			const reader = new FileReader();
			reader.onload = (e) => {
				imagePreview.src = e.target.result;
				imagePreview.style.display = "block";

				// Adjust container height dynamically when image loads
				imagePreview.onload = () => {
					imageContainer.style.height = imagePreview.height + "px";
				};

				// Destroy previous cropper instance if any
				if (cropper) {
					cropper.destroy();
				}

				// Initialize Cropper.js
				cropper = new Cropper(imagePreview, {
					viewMode: 1,
					autoCropArea: 0.8,
					dragMode: 'move',
					aspectRatio: NaN,
					background: true,
					guides: true,
					center: true,
					highlight: true,
					cropBoxResizable: true,
					cropBoxMovable: true,
					ready() {
						cropBtn.disabled = false;
						ocrBtn.disabled = true;
						textOutput.textContent = "";
						statusText.textContent = "";
						copyBtn.disabled = true;
						downloadBtn.disabled = true;
					}
				});
			};
			reader.readAsDataURL(file);
		});

		cropBtn.addEventListener('click', () => {
			if (!cropper) return;
			// Get cropped area canvas WITHOUT resizing (no maxWidth or maxHeight)
			croppedCanvas = cropper.getCroppedCanvas({
				imageSmoothingEnabled: true,
				imageSmoothingQuality: 'high'
			});

			if (!croppedCanvas) {
				alert("Failed to crop image. Please try again.");
				return;
			}

			// Replace preview with cropped image and destroy cropper to prevent confusion
			const croppedDataUrl = croppedCanvas.toDataURL();

			imagePreview.onload = () => {
				// Adjust container height to cropped image height
				imageContainer.style.height = imagePreview.height + "px";
			};

			cropper.destroy();
			cropper = null;

			imagePreview.src = croppedDataUrl;
			statusText.textContent = "Image cropped. Ready to extract text.";
			ocrBtn.disabled = false;
			cropBtn.disabled = true;
			textOutput.textContent = "";
			copyBtn.disabled = true;
			downloadBtn.disabled = true;
		});

		ocrBtn.addEventListener('click', async () => {
			if (!imagePreview.src) return;

			statusText.textContent = "Processing image ...";
			textOutput.textContent = "";
			copyBtn.disabled = true;
			downloadBtn.disabled = true;

			// Use cropped image if available, else original
			const imgToRecognize = croppedCanvas ? croppedCanvas.toDataURL() : imagePreview.src;

			// Disable buttons to prevent re-clicks
			ocrBtn.disabled = true;
			cropBtn.disabled = true;
			imageUpload.disabled = true;

			// Disable Tesseract logging for cleaner output
			Tesseract.setLogging(false);

			await Tesseract.recognize(imgToRecognize, 'eng', {
				logger: m => {
					// Stepwise status update
					if (m.status === 'recognizing text') {
						statusText.textContent = `Recognizing text... (${Math.round(m.progress * 100)}%)`;
					} else if (m.status === 'loading tesseract core') {
						statusText.textContent = "Loading OCR engine...";
					} else if (m.status === 'initializing tesseract') {
						statusText.textContent = "Initializing OCR engine...";
					} else {
						statusText.textContent = m.status + '...';
					}
				}
			}).then(result => {
				statusText.textContent = "OCR Completed.";
				const paragraphText = result.data.text.replace(/\n+/g, ' ').replace(/\s{2,}/g, ' ').trim();
				textOutput.textContent = paragraphText || "No text found.";
				copyBtn.disabled = false;
				downloadBtn.disabled = false;

				// Re-enable controls for new image
				imageUpload.disabled = false;
				ocrBtn.disabled = false;
				cropBtn.disabled = true;
			}).catch(err => {
				statusText.textContent = "Error: " + err.message;
				imageUpload.disabled = false;
				ocrBtn.disabled = false;
				cropBtn.disabled = false;
			});
		});

		copyBtn.addEventListener('click', () => {
		  const text = textOutput.textContent;
		  if (!text) {
		    showMessage("No text to copy.", false);
		    return;
		  }
		
		if (navigator.clipboard && window.isSecureContext) {
		  navigator.clipboard.writeText(text)
		  .then(() => showMessage("Copied to clipboard!", true))
		  .catch(() => fallbackCopyText(text));
		  } else {
		  fallbackCopyText(text);
		  }
		
		  function fallbackCopyText(text) {
		    const textArea = document.createElement("textarea");
		    textArea.value = text;
		    textArea.style.position = "fixed";
		    textArea.style.top = "-100px";
		    textArea.style.left = "-100px";
		    document.body.appendChild(textArea);
		    textArea.focus();
		    textArea.select();
		
		  try {
		      const successful = document.execCommand('copy');
		    showMessage(successful ? "Copied to clipboard!" : "Copy failed.", successful);
		    } catch (err) {
		      showMessage("Fallback: Unable to copy.", false);
		    }
		
		   document.body.removeChild(textArea);
		  }
		  });

	  downloadBtn.addEventListener('click', () => {
	    const text = textOutput.textContent;
	    if (!text) {
	      showMessage("No text to download.", false);
	    return;
	  }
	  const blob = new Blob([text], { type: "text/plain" });
	  const url = URL.createObjectURL(blob);
	  const a = document.createElement('a');
	  a.href = url;
	  a.download = "extracted-text.txt";
	  document.body.appendChild(a);
	  a.click();
  	document.body.removeChild(a);
  	URL.revokeObjectURL(url);
	
	    showMessage("Downloaded as .txt!", true);
	    });


	  function showMessage(message, isSuccess = true) {
	    const msg = document.getElementById("action-message");
	    msg.textContent = message;
	    msg.style.color = isSuccess ? "green" : "red";
	    setTimeout(() => {
	    msg.textContent = "";
	    }, 3000);
	  }

		function resetAll() {
			if (cropper) {
				cropper.destroy();
				cropper = null;
			}
			imagePreview.src = "";
			imagePreview.style.display = "none";
			statusText.textContent = "";
			textOutput.textContent = "";
			cropBtn.disabled = true;
			ocrBtn.disabled = true;
			copyBtn.disabled = true;
			downloadBtn.disabled = true;
			imageUpload.value = "";
			// Reset container height
			imageContainer.style.height = "auto";
		}
			</script>
		</body>

		</html>
	</body>
	<html>
</body>
<html></body><html>